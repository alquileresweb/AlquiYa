<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de Dueños</title>
</head>
<body>
  <h2>Mis Alquileres</h2>
  <div id="alquileres"></div>

  <h3>Agregar Alquiler</h3>
  <input id="direccion" placeholder="Dirección"><br>
  <input id="ambientes" placeholder="Ambientes"><br>
  <input id="precio" placeholder="Precio"><br>
  <input id="mascotas" placeholder="Mascotas (Sí/No)"><br>
  <button onclick="agregar()">Agregar</button>

  <br><br>
  <button onclick="cerrarSesion()">Cerrar Sesión</button>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwDl73ZMnMowfSu_NoISSSc4fnQpLp6kaxT9Dz5jMjE9NxT64AmeN23ORQy8lejul6S/exec";
    const dueno = localStorage.getItem("dueno");

    if (!dueno) window.location.href = "index.html";

    async function cargarAlquileres() {
      let res = await fetch(`${API_URL}?action=getAlquileres&dueno=${dueno}`);
      let data = await res.json();

      if (data.success) {
        let html = "";
        data.alquileres.forEach(a => {
          html += `
            <div>
              <b>${a.direccion}</b> - ${a.ambientes} amb - $${a.precio} - Mascotas: ${a.mascotas} 
              <br>Estado: ${a.estado}
              <button onclick="cambiarEstado(${a.id}, '${a.estado}')">Cambiar Estado</button>
              <hr>
            </div>`;
        });
        document.getElementById("alquileres").innerHTML = html;
      }
    }

    async function agregar() {
      let direccion = document.getElementById("direccion").value;
      let ambientes = document.getElementById("ambientes").value;
      let precio = document.getElementById("precio").value;
      let mascotas = document.getElementById("mascotas").value;

      await fetch(`${API_URL}?action=addAlquiler&dueno=${dueno}&direccion=${direccion}&ambientes=${ambientes}&precio=${precio}&mascotas=${mascotas}`);
      cargarAlquileres();
    }

    async function cambiarEstado(id, estado) {
      let nuevo = estado === "activo" ? "inactivo" : "activo";
      await fetch(`${API_URL}?action=updateEstado&id=${id}&estado=${nuevo}`);
      cargarAlquileres();
    }

    function cerrarSesion() {
      localStorage.removeItem("dueno");
      window.location.href = "index.html";
    }

    cargarAlquileres();
  </script>
</body>
</html>
