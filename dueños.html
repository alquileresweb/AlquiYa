<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Due침os</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial,sans-serif;max-width:600px;margin:auto;padding:20px;}
h2{color:#3483fa;}
input,select,button{width:100%;padding:8px;margin:5px 0;border-radius:6px}
button{background:#3483fa;color:white;border:none;cursor:pointer}
button:hover{background:#2565c0}
</style>
</head>
<body>
<h2>Panel de Due침os</h2>
<p id="bienvenida"></p>
<h3>Agregar Nuevo Alquiler</h3>
<input type="text" id="direccion" placeholder="Direcci칩n">
<input type="text" id="latitud" placeholder="Latitud">
<input type="text" id="longitud" placeholder="Longitud">
<select id="ambientes">
<option value="Monoambiente">Monoambiente</option>
<option value="2 ambientes">2 ambientes</option>
<option value="3 ambientes">3 ambientes</option>
</select>
<input type="text" id="precio" placeholder="Precio">
<input type="text" id="contacto" placeholder="WhatsApp">
<input type="text" id="fotos" placeholder="URL de fotos (opcional)">
<button onclick="agregarAlquiler()">Agregar Alquiler</button>
<p id="msg" style="color:green"></p>
<button onclick="logout()">Cerrar Sesi칩n</button>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbwDl73ZMnMowfSu_NoISSSc4fnQpLp6kaxT9Dz5jMjE9NxT64AmeN23ORQy8lejul6S/exec";

window.onload = function(){
  const nombre = localStorage.getItem("dueno");
  if(!nombre){ window.location.href="index.html"; return; }
  document.getElementById("bienvenida").textContent="Bienvenido "+nombre;
}

async function agregarAlquiler(){
  const email = localStorage.getItem("dueno_email");
  const nombre = localStorage.getItem("dueno");
  const data = {
    action:"agregar",
    email,
    nombre,
    direccion: document.getElementById("direccion").value.trim(),
    latitud: document.getElementById("latitud").value.trim(),
    longitud: document.getElementById("longitud").value.trim(),
    ambientes: document.getElementById("ambientes").value,
    precio: document.getElementById("precio").value.trim(),
    contacto: document.getElementById("contacto").value.trim(),
    fotos: document.getElementById("fotos").value.trim()
  };
  try{
    const resp = await fetch(WEBAPP_URL,{
      method:"POST",
      body: JSON.stringify(data),
      headers: {"Content-Type":"application/json"}
    });
    const result = await resp.json();
    if(result.success){
      document.getElementById("msg").textContent="Alquiler agregado correctamente!";
      document.getElementById("direccion").value="";
      document.getElementById("latitud").value="";
      document.getElementById("longitud").value="";
      document.getElementById("precio").value="";
      document.getElementById("contacto").value="";
      document.getElementById("fotos").value="";
    } else {
      document.getElementById("msg").textContent="Error al agregar: "+(result.message||"");
    }
  } catch(e){
    document.getElementById("msg").textContent="Error al conectar con servidor";
    console.error(e);
  }
}

function logout(){
  localStorage.removeItem("dueno");
  localStorage.removeItem("dueno_email");
  window.location.href="index.html";
}
</script>
</body>
</html>
