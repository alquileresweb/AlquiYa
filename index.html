<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SSJ5DG33JK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-SSJ5DG33JK');
</script>
<link rel="icon" type="image/png" href="https://i.postimg.cc/MKpMcrcQ/AlquiYa.png">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
  :root {
    --primary: #3483fa;
    --primary-dark: #2565c0;
    --success: #25D366;
    --bg: #fafafa;
    --card: white;
    --text: #333;
    --border: #e0e0e0;
    --shadow: 0 4px 20px rgba(0,0,0,0.08);
    --radius: 14px;
    --transition: all 0.3s ease;
  }

  /* CHECKBOXES PERSONALIZADOS - PEGADOS AL TEXTO Y BONITOS */
.checkbox-label {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 500;
  cursor: pointer;
  user-select: none;
  white-space: nowrap;
  margin: 8px 0;
  font-size: 1rem;
  color: #333;
}

.checkbox-label input[type="checkbox"] {
  opacity: 0;
  position: absolute;
  cursor: pointer;
}

.custom-checkbox {
  width: 20px;
  height: 20px;
  border: 2.5px solid #3483fa;
  border-radius: 6px;
  background: white;
  position: relative;
  flex-shrink: 0;
  transition: all 0.2s ease;
}

.custom-checkbox::after {
  content: "‚úì";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  color: white;
  font-weight: bold;
  font-size: 14px;
  transition: transform 0.2s ease;
}

.checkbox-label input[type="checkbox"]:checked + .custom-checkbox {
  background: var(--primary);
  border-color: var(--primary);
}

.checkbox-label input[type="checkbox"]:checked + .custom-checkbox::after {
  transform: translate(-50%, -50%) scale(1);
}

.checkbox-label:hover .custom-checkbox {
  box-shadow: 0 0 8px rgba(52, 131, 250, 0.3);
}
  
  /* === NRO DE AMBIENTES SUPERPUESTO ‚Äì AHORA M√ÅS ARRIBA Y SIN FONDO === */
  .ambientes-overlay {
    position: absolute;
    top: 180px;               /* ‚Üê m√°s arriba */
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.45);
    color: white;
    padding: 9px 20px;
    border-radius: 50px;
    font-size: 1.45rem;
    font-weight: bold;
    backdrop-filter: blur(6px);
    z-index: 2;
    white-space: nowrap;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }
  
  * { box-sizing: border-box; }
  body { margin: 0; font-family: 'Inter', 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
  header { background: white; padding: 1rem; text-align: center; box-shadow: var(--shadow); position: sticky; top: 0; z-index: 1000; }
  header img { max-width: 250px; height: auto; }

  /* === MEN√ö PRINCIPAL - ULTRA-COMPACTO Y PERFECTAMENTE CENTRADO === */
nav {
  display: flex;
  justify-content: center;     /* centra horizontalmente los items */
  align-items: center;
  gap: 0.8rem;
  background: white;
  padding: 0.9rem 1rem;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  
  /* Lo importante para que quede centrado incluso con scroll horizontal */
  flex-wrap: nowrap;
  overflow-x: auto;
  white-space: nowrap;
  scrollbar-width: none;
  -webkit-overflow-scrolling: touch;         /* scroll m√°s suave en iOS */
  
  /* Este truco fuerza el centrado real cuando hay scroll */
  padding-left: max(1rem, env(safe-area-inset-left));
  padding-right: max(1rem, env(safe-area-inset-right));
  margin: 0 auto;
  max-width: 100vw;
}

nav::-webkit-scrollbar { display: none; }

/* Los enlaces */
nav a {
  text-decoration: none;
  font-weight: 600;
  color: var(--text);
  padding: 0.65rem 1rem;
  border-radius: 10px;
  transition: var(--transition);
  font-size: 0.95rem;
  min-width: fit-content;
  flex-shrink: 0;                    /* evita que se compriman */
}

nav a:hover,
nav a.active {
  background: var(--primary);
  color: white;
}

/* En m√≥viles muy peque√±os: a√∫n m√°s compacto pero sigue centrado */
@media (max-width: 480px) {
  nav {
    gap: 0.5rem;
    padding: 0.75rem 0.8rem;
    justify-content: center;        /* reforzamos el centrado */
  }
  nav a {
    padding: 0.55rem 0.85rem;
    font-size: 0.9rem;
  }
}

  /* === PIE DE P√ÅGINA AZUL === */
  footer {
    background: var(--primary);
    color: white;
    padding: 2.5rem 1rem 1.5rem;
    margin-top: 4rem;
  }
  .footer-container {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    align-items: center;
    text-align: center;
  }
  .footer-logo img {
    max-width: 180px;
    height: auto;
  }
  .footer-menu a {
    color: white;
    text-decoration: none;
    font-weight: 600;
    margin: 0 1rem;
    font-size: 1.1rem;
    transition: var(--transition);
  }
  .footer-menu a:hover {
    text-decoration: underline;
  }
  .footer-social a {
    margin: 0 12px;
    display: inline-block;
    transition: transform 0.3s ease;
  }
  .footer-social a:hover {
    transform: translateY(-4px);
  }
  .footer-social img {
    width: 40px;
    height: 40px;
  }
  .footer-copy {
    font-size: 0.95rem;
    opacity: 0.9;
    margin-top: 1.5rem;
    grid-column: 1 / -1;
  }
  @media (max-width: 768px) {
    .footer-container {
      grid-template-columns: 1fr;
      text-align: center;
    }
    .footer-menu a {
      display: block;
      margin: 0.8rem 0;
    }
  }

  /* BOTONES DEBAJO DEL MEN√ö - CORTOS, JUNTOS Y CENTRADOS */
#botones-filtros-avisos {
  display: none;
  justify-content: center;
  align-items: center;
  gap: 12px;                    /* espacio entre botones */
  padding: 0.75rem 1rem;
  background: white;
  border-bottom: 1px solid #eee;
  flex-wrap: nowrap;            /* evita que se bajen en m√≥viles */
  overflow-x: auto;             /* si no caben, permite scroll horizontal (mejor que romper) */
  white-space: nowrap;
  scrollbar-width: none;        /* Firefox - oculta scrollbar */
}
#botones-filtros-avisos::-webkit-scrollbar { display: none; } /* Chrome/Safari */

#botones-filtros-avisos.visible {
  display: flex;
}
/* BOTONES M√ÅS CORTOS Y COMPACTOS */
#botones-filtros-avisos button {
  padding: 0.5rem 1rem;         /* m√°s corto */
  min-width: auto;              /* quita el ancho m√≠nimo */
  width: auto;
  font-size: 0.9rem;
  font-weight: 600;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(52,131,250,0.25);
  transition: all 0.3s ease;
  white-space: nowrap;
}

#botones-filtros-avisos button:hover {
  background: var(--primary-dark);
  transform: translateY(-3px);
  box-shadow: 0 6px 16px rgba(52,131,250,0.35);
}

#botones-filtros-avisos button:active {
  transform: translateY(-1px);
}

  /* UBICACI√ìN - MINIMALISTA Y ELEGANTE */
.ubicacion-panel {
  margin: 25px auto 35px;
  max-width: 900px;
  padding: 0.8rem 1.5rem;
  background: transparent;
  color: #444;
  font-size: 1.35rem;           /* ‚Üê m√°s peque√±a y refinada */
  font-weight: 600;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  letter-spacing: 0.5px;
}

.ubicacion-panel::before {
  content: "";
  font-size: 1.6rem;
}

/* En m√≥viles se ve a√∫n m√°s limpio */
@media (max-width: 768px) {
  .ubicacion-panel {
    font-size: 1.25rem;
    margin: 20px auto 30px;
    gap: 8px;
  }
  .ubicacion-panel::before {
    font-size: 1.5rem;
  }
}
  /* === TARJETAS EN LISTA - ESTILOS CORREGIDOS Y √öNICOS === */
  .property-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
    max-width: 1400px;
    margin: 20px auto 40px auto !important;
    padding: 0 20px;
    justify-items: center;
  }

  .property-card {
    background: white;
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 400px;
    transition: all 0.3s ease;
    border: 1px solid #eee;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }
  .property-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
  }
  .property-card img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    border-radius: 15px;
    margin-bottom: 20px;
    cursor: zoom-in;
    transition: transform 0.3s ease;
  }
  .property-card img:hover { transform: scale(1.03); }

  .property-title { font-size: 1.5em; font-weight: bold; color: #333; margin-bottom: 12px; }
  .property-price { font-size: 1.4em; color: #28a745; font-weight: bold; margin-bottom: 15px; }

  .ver-detalles-btn {
    background: var(--primary);
    color: white;
    padding: 11px 20px;
    border: none;
    border-radius: 50px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    width: 100%;
    margin-top: 10px;
    transition: var(--transition);
  }
  .ver-detalles-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
  }

  /* MODAL DE IM√ÅGENES CON FLECHAS < > */
  #modal-img {
    display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.96); backdrop-filter: blur(12px);
    align-items: center; justify-content: center; z-index: 9999; padding: 2rem;
  }
  #modal-img img { max-width: 95%; max-height: 95%; border-radius: 18px; box-shadow: 0 30px 80px rgba(0,0,0,0.7); object-fit: contain; }
  .close-btn, .prev-btn, .next-btn {
    position: absolute; background: rgba(255,255,255,0.25); color: white; border: none;
    width: 56px; height: 56px; border-radius: 50%; font-size: 32px; font-weight: bold;
    cursor: pointer; backdrop-filter: blur(12px); transition: var(--transition); z-index: 10;
  }
  .close-btn:hover, .prev-btn:hover, .next-btn:hover { background: var(--primary); transform: scale(1.15); }
  .close-btn { top: 20px; right: 20px; }
  .prev-btn { left: 20px; }
  .next-btn { right: 20px; }
  
  .property-title {
    font-size: 1.5em;
    font-weight: bold;
    color: #333;
    margin-bottom: 15px;
  }
  .property-price {
    font-size: 1.4em;
    color: #28a745;
    font-weight: bold;
    margin-bottom: 15px;
  }
  .whatsapp-btn {
    background: linear-gradient(45deg, #25D366, #128C7E);
    color: white;
    padding: 12px 25px;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-size: 1em;
    font-weight: bold;
    text-decoration: none;
    display: inline-block;
    margin: 5px;
    transition: all 0.3s;
  }
  .whatsapp-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(37,211,102,0.4);
  }
  #boton-filtros-container button {
    padding: 0.85rem 1.8rem;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: var(--radius);
    font-weight: 600;
    cursor: pointer;
    box-shadow: var(--shadow);
    transition: var(--transition);
    white-space: nowrap;
  }
  #boton-filtros-container button:hover {
    background: var(--primary-dark);
    transform: translateY(-3px);
  }
  #filtros {
    max-width: 800px;
    margin: 0 auto 2rem;
    padding: 1.8rem;
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    display: none;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: end;
  }
  #filtros input,
  #filtros select {
    padding: 0.9rem 1rem;
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    font-size: 1rem;
    flex: 1;
    min-width: 140px;
    transition: var(--transition);
  }
  #filtros input:focus,
  #filtros select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(52,131,250,0.15);
  }
  #filtros label {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    font-weight: 500;
    white-space: nowrap;
  }
  #filtros button {
    padding: 0.9rem 2.5rem;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: var(--radius);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
  }
  #filtros button:hover {
    background: var(--primary-dark);
    transform: translateY(-3px);
  }
  #map {
    height: 65vh;
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    margin: 1.5rem auto;
    max-width: 1400px;
  }
  #loading-msg {
    text-align: center;
    font-weight: 600;
    color: var(--primary);
    font-size: 1.3rem;
    margin: 2rem;
    display: none;
  }
  #alquiler-detalle {
    display: none;
    max-width: 800px;
    margin: 2rem auto;
    padding: 2rem;
    background: var(--card);
    border: 2px solid var(--primary);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    animation: fadeIn 0.6s ease;
    position: relative;
  }
  #alquiler-detalle.highlight { animation: resaltar 1.2s ease; }
  #alquiler-detalle h2 {
    margin-top: 0;
    color: var(--primary);
    font-size: 2rem;
  }
  #alquiler-detalle p {
    margin: 0.9rem 0;
    padding-bottom: 0.9rem;
    border-bottom: 1px solid #eee;
  }
  #alquiler-detalle p:last-child { border-bottom: none; }
  .action-buttons {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin: 1.5rem 0;
  }
  .copy-share-btn {
    background: #10b981;
    color: white;
    padding: 1rem 1.8rem;
    border-radius: var(--radius);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
  }
  .copy-share-btn:hover { background: #059669; }
  #imagenes-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap: 14px;
    margin: 1.8rem 0;
  }
  #imagenes-container img {
    width: 100%;
    height: 110px;
    object-fit: cover;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 3px 12px rgba(0,0,0,0.12);
    transition: var(--transition);
  }
  #imagenes-container img:hover {
    transform: scale(1.06);
    box-shadow: 0 10px 30px rgba(0,0,0,0.22);
  }

  /* === QUITAR ESPACIO EN BLANCO DESPU√âS DE LAS PROPIEDADES === */
#vista-lista {
  margin-bottom: 0 !important;
  padding-bottom: 20px;        /* espacio controlado y peque√±o antes del banner */
}
  
  /* Marcadores con los emojis originales (sin tocar el estilo) */
  .marker-icon {
display:flex;
align-items:center;
justify-content:center;
background:#3483fa;
color:white;
font-weight:bold;
border-radius:50%;
width:30px;
height:30px;
border:2px solid white;
box-shadow:0 0 2px #000;
}
  .popup-button {
    display: inline-block;
    padding: 8px 16px;
    margin-top: 8px;
    background: var(--primary);
    color: white;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: var(--transition);
  }
  .popup-button:hover { background: var(--primary-dark); }

  /* C√≠rculo foto de perfil (popup y detalle) */
  .owner-profile-img,
  .popup-profile-img {
    position: absolute;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid white;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 10;
    cursor: pointer; /* <-- IMPORTANTE: para que se pueda tocar */
    transition: transform 0.2s ease;
  }
  .owner-profile-img:hover,
  .popup-profile-img:hover {
    transform: scale(1.1);
  }
  .owner-profile-img {
    top: 12px;
    right: 12px;
    width: 56px;
    height: 56px;
  }
  .popup-profile-img {
    top: 8px;
    right: 8px;
    width: 44px;
    height: 44px;
    border: 2px solid white;
  }

  #modal-img {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.94);
    backdrop-filter: blur(10px);
    align-items: center;
    justify-content: center;
    z-index: 9999;
    padding: 2rem;
  }
  #modal-img img {
    max-width: 95%;
    max-height: 95%;
    border-radius: 18px;
    box-shadow: 0 25px 60px rgba(0,0,0,0.6);
  }
  .nav-btn, .close-btn {
    position: absolute;
    background: rgba(255,255,255,0.2);
    color: white;
    border: none;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    font-size: 30px;
    cursor: pointer;
    backdrop-filter: blur(12px);
    transition: var(--transition);
  }
  .nav-btn:hover, .close-btn:hover {
    background: var(--primary);
    transform: scale(1.12);
  }
  .close-btn { top: 20px; right: 20px; }
  .prev-btn { left: 20px; }
  .next-btn { right: 20px; }

  /* Paneles login, registro, avisos */
  #login, #registro, #avisos-panel, #panel-dueno {
    display: none;
    max-width: 500px;
    margin: 3rem auto;
    padding: 2.5rem;
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    text-align: center;
  }
  #login h2, #registro h2, #avisos-panel h2 {
    color: var(--primary);
    margin-bottom: 1.5rem;
  }
  input, select, button {
    width: 100%;
    padding: 0.9rem;
    margin: 0.8rem 0;
    border-radius: var(--radius);
    border: 1.5px solid var(--border);
    font-size: 1rem;
  }
  button {
    background: var(--primary);
    color: white;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
  }
  button:hover {
    background: var(--primary-dark);
    transform: translateY(-3px);
  }
  .password-container {
    position: relative;
    display: flex;
    align-items: center;
  }
  .eye-icon {
    position: absolute;
    right: 12px;
    width: 24px;
    height: 24px;
    cursor: pointer;
    background: url('https://img.icons8.com/ios/50/000000/visible.png') no-repeat center/contain;
  }
  #publicidad-container {
    background: var(--card);
    border: 2px dashed var(--border);
    border-radius: var(--radius);
    padding: 2rem;
    margin: 2rem auto;
    max-width: 700px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
  }
  #publicidad-container:hover {
    border-color: var(--primary);
    box-shadow: var(--shadow);
  }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes resaltar { 0%, 100% { transform: scale(1); box-shadow: var(--shadow); } 50% { transform: scale(1.02); box-shadow: 0 0 35px rgba(52,131,250,0.4); } }
  @media (max-width: 768px) {
    #boton-filtros-container { flex-direction: column; }
    #boton-filtros-container button { width: 80%; margin: 0 auto; }
    #filtros, #login, #registro { padding: 1.5rem; margin: 1.5rem; }
    #map { height: 55vh; }
  }
  /* BANNER FINAL DE RAPICLEAN */
  .final-banner {
    width: 100%; margin-top: 0 !important; margin-bottom: 40px; text-align: center; padding: 0 15px;
  }
  .final-banner img {
    width: 100%; max-width: 1000px; height: auto; border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2); transition: transform 0.3s;
  }
  .final-banner img:hover { transform: scale(1.02); }

  #map { height: 65vh; border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); margin: 1.5rem auto; max-width: 1400px; }
</style>
</head>
<body>
<header>
  <img src="https://i.postimg.cc/SxDLDXZz/logo-Alqui-Ya-fondo-blanco-Photoroom-Photoroom.jpg" alt="Logo Alqui Ya">
</header>
<!-- T√©rminos solo una vez -->
<div id="modal-terminos" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:9999;align-items:center;justify-content:center;">
  <div id="modal-terminos-content" style="background:white;max-width:90%;max-height:90%;overflow-y:auto;padding:2rem;border-radius:14px;box-shadow:var(--shadow);">
    <h2>T√©rminos y Condiciones de Uso</h2>
    <p><strong>√öltima actualizaci√≥n: 10/09/2025</strong></p>
<p>Bienvenido/a a AlquiYa (en adelante, ‚Äúla Plataforma‚Äù).<br>
Al acceder o utilizar la Plataforma, usted acepta estos T√©rminos y Condiciones. Si no est√° de acuerdo, debe abstenerse de usarla.</p>
<h3>1. Naturaleza del Servicio ‚Äì Exclusi√≥n de Intermediaci√≥n Inmobiliaria</h3>
<p>La Plataforma es un intermediador publicitario digital que facilita la publicaci√≥n y visualizaci√≥n de ofertas de alquiler de inmuebles.<br>
No somos corredores inmobiliarios ni una inmobiliaria.<br>
No participamos en la negociaci√≥n, celebraci√≥n ni ejecuci√≥n de contratos de alquiler o compraventa.<br>
Cualquier acuerdo, gesti√≥n o transacci√≥n vinculada al alquiler se realiza de manera directa entre Due√±os y Usuarios, sin intervenci√≥n ni responsabilidad de la Plataforma.</p>
<h3>2. Publicaciones y Responsabilidad de los Due√±os</h3>
<p>Los Due√±os son responsables de la informaci√≥n, im√°genes y condiciones que publiquen.<br>
La Plataforma no garantiza la veracidad ni autenticidad de las publicaciones.<br>
Si un Usuario detecta un anuncio falso o sospechoso, podr√° reportarlo a trav√©s de <a href="mailto:alquiya@gmail.com">alquiya@gmail.com</a> para que sea revisado y eventualmente eliminado.<br>
El Due√±o se compromete a proporcionar datos de contacto reales y verificables (email y tel√©fono).</p>
<h3>3. Exenci√≥n de Responsabilidad por Fraudes o Estafas</h3>
<p>La Plataforma no ser√° responsable por fraudes, enga√±os o incumplimientos cometidos por Due√±os o Usuarios.<br>
El Usuario reconoce y acepta que:<br>
- Debe verificar por su cuenta la existencia del inmueble y la identidad del Due√±o antes de concretar operaciones.<br>
- Cualquier perjuicio econ√≥mico, da√±o o p√©rdida derivados de anuncios falsos es ajeno a la responsabilidad de la Plataforma.</p>
<h3>4. Protecci√≥n de Datos Personales</h3>
<p>La Plataforma cumple con la Ley de Protecci√≥n de Datos Personales N¬∫ 25.326.<br>
Los datos proporcionados ser√°n utilizados √∫nicamente para el funcionamiento de la Plataforma.<br>
El Usuario puede ejercer sus derechos de acceso, rectificaci√≥n o supresi√≥n comunic√°ndose a <a href="mailto:alquiya@gmail.com">alquiya@gmail.com</a>.<br>
La base de datos ser√° registrada ante la Agencia de Acceso a la Informaci√≥n P√∫blica conforme a la normativa vigente.</p>
<h3>5. Relaci√≥n de Consumo ‚Äì Limitaciones de Responsabilidad</h3>
<p>En caso de que el servicio contratado (ej. publicaci√≥n destacada, plan pago) no funcione correctamente, el Usuario deber√° notificarlo dentro de los 7 d√≠as posteriores para gestionar un ajuste o reembolso si corresponde.<br>
La responsabilidad de la Plataforma se limita estrictamente al monto abonado por el servicio contratado.<br>
En ning√∫n caso la Plataforma ser√° responsable por:<br>
- Lucro cesante, p√©rdida de chance o da√±os indirectos.<br>
- El √©xito de la operaci√≥n de alquiler entre Due√±os y Usuarios.</p>
<h3>6. Contenido y Derechos de Autor</h3>
<p>El Due√±o declara que cuenta con derechos de uso sobre las im√°genes, textos y contenidos que publique.<br>
La Plataforma no ser√° responsable por infracciones a derechos de autor cometidas por los Due√±os.<br>
En caso de reclamo de terceros, el Due√±o mantendr√° indemne a la Plataforma.</p>
<h3>7. Uso Permitido</h3>
<p>Queda prohibido utilizar la Plataforma para:<br>
- Publicar informaci√≥n falsa, ilegal, discriminatoria o que vulnere derechos de terceros.<br>
- Suplantar la identidad de otra persona.<br>
- Subir material protegido sin autorizaci√≥n.</p>
<h3>8. Modificaciones</h3>
<p>La Plataforma podr√° modificar los presentes T√©rminos y Condiciones en cualquier momento, notificando a los Usuarios mediante su publicaci√≥n en el sitio.</p>
<h3>9. Ley Aplicable y Jurisdicci√≥n</h3>
<p>Los presentes T√©rminos se rigen por las leyes de la Rep√∫blica Argentina.<br>
Cualquier conflicto ser√° resuelto ante los tribunales ordinarios de Santo Tom√©, Corrientes, renunciando expresamente a cualquier otro fuero.</p>
    <button onclick="aceptarTerminos()" style="margin-top:2rem;padding:1rem 2rem;background:var(--primary);color:white;border:none;border-radius:var(--radius);cursor:pointer;">Aceptar T√©rminos y Condiciones</button>
  </div>
</div>
  <!-- NUEVO MEN√ö CON 3 PESTA√ëAS -->
<nav>
  <a href="#" id="tab-lista" class="active" onclick="mostrarLista()">Ver Lista</a>
  <a href="#" id="tab-mapa" onclick="mostrarMapa()">Ver Mapa</a>
  <a href="#" id="tab-publicar" onclick="mostrarLogin()">Publicar Propiedad</a>
</nav>

    <!-- NUEVOS BOTONES DEBAJO DEL MEN√ö (aparecen solo en Lista y Mapa) -->
<div id="botones-filtros-avisos">
  <button onclick="toggleFiltros()">A√±adir filtros</button>
  <button onclick="mostrarAvisos()">Recibir avisos</button>
</div>
  
<!-- PANEL FILTROS - CHECKBOXES BIEN PEGADOS AL TEXTO -->
<div id="filtros">
  <input type="number" id="filtroAmb" placeholder="Nro de Ambientes">
  <input type="text" id="filtroMin" placeholder="Precio M√≠nimo" oninput="formatCurrency(this)">
  <input type="text" id="filtroMax" placeholder="Precio M√°ximo" oninput="formatCurrency(this)">
  <select id="filtroTipo">
    <option value="">Todos los tipos</option>
    <option value="Departamento">Departamento</option>
    <option value="Temporario">Alquiler Temporario</option>
    <option value="Local">Local Comercial</option>
  </select>

  <!-- CHECKBOXES CON TEXTO AL LADO Y PERFECTAMENTE ALINEADOS -->
  <label class="checkbox-label">
    <input type="checkbox" id="filtroMascotas">
    <span class="custom-checkbox"></span>
    Mascotas Permitidas
  </label>

  <label class="checkbox-label">
    <input type="checkbox" id="filtroAmoblado">
    <span class="custom-checkbox"></span>
    Amoblado
  </label>

  <button onclick="aplicarFiltros()">Filtrar</button>
</div>
  
<!-- PANEL AVISOS -->
<div id="avisos-panel">
  <h2>Recibir Notificaciones</h2>
  <input type="text" id="avisos_email" placeholder="Email">
  <button onclick="registrarEmailAvisos()">Suscribirse</button>
  <button onclick="cerrarAvisos()">Cancelar</button>
  <p id="avisos-msg" style="color:green"></p>
</div>

<!-- MODAL IM√ÅGENES -->
<div id="modal-img" onclick="if(event.target === this) cerrarModal()">
  <img id="img-grande" src="" alt="Imagen grande">
  <button class="close-btn" onclick="cerrarModal()">X</button>
  <button class="prev-btn" onclick="cambiarImagen(-1)"><</button>
  <button class="next-btn" onclick="cambiarImagen(1)">></button>
</div>

  <!-- UBICACI√ìN FIJA (APARECE EN LISTA Y MAPA) -->
<div class="ubicacion-panel">
  üìç Santo Tom√©, Corrientes
</div>

<!-- VISTA LISTA -->
<div id="vista-lista">
  <div class="property-grid" id="lista-propiedades">
    <div style="grid-column:1/-1;text-align:center;padding:80px;font-size:1.4rem;color:#666;">Cargando propiedades...</div>
  </div>
</div>

<!-- VISTA MAPA -->
<div id="vista-mapa">
  <div id="filtros"> <!-- tus filtros aqu√≠ --> </div>
  <div id="avisos-panel"> <!-- panel avisos --> </div>
  <div id="loading-msg">Cargando alquileres disponibles...</div>
  <div id="map" style="height:65vh;"></div>
</div>

<!-- VISTA PUBLICAR (SOLO UNA VEZ, CORRECTAMENTE) -->
<div id="vista-publicar" style="display:none;">
  <div id="login">
    <h2>Login Due√±os</h2>
    <input type="text" id="email" placeholder="Email">
    <div class="password-container">
      <input type="password" id="password" placeholder="Contrase√±a">
      <div class="eye-icon" onclick="togglePassword('password')"></div>
    </div>
    <button onclick="login()">Ingresar</button>
    <p id="login-loading" style="color:#3483fa;display:none;">Iniciando sesi√≥n...</p>
    <p>¬øNo tienes cuenta?</p>
    <p><button onclick="mostrarRegistro()">Registrarme</button></p>
    <p id="login-msg" style="color:red"></p>
  </div>

  <div id="registro" style="display:none;">
    <h2>Registro Due√±os</h2>
    <input type="text" id="reg_email" placeholder="Email">
    <input type="text" id="reg_nombre" placeholder="Nombre">
    <div class="password-container">
      <input type="password" id="reg_password" placeholder="Contrase√±a">
      <div class="eye-icon" onclick="togglePassword('reg_password')"></div>
    </div>
    <div id="reg_contacto-container">
      <select id="reg_codigo_pais">
        <option value="+54">+54 (Argentina)</option>
        <option value="+55">+55 (Brasil)</option>
      </select>
      <input type="text" id="reg_contacto" placeholder="WhatsApp (ej: 3794000000)">
    </div>
    <button onclick="registrarDueno()">Registrar</button>
    <button onclick="mostrarLogin()">Cancelar</button>
    <p id="registro-msg" style="color:green"></p>
  </div>
</div>
  
<div id="loading-msg">Cargando alquileres disponibles...</div>
<div id="map"></div>
  
<!-- BANNER FINAL BONITO -->
  <div class="final-banner">
    <a href="https://wa.me/5493764391885" target="_blank">
      <img src="https://i.postimg.cc/rmsfYsVr/Mas-de-40-estudiantes-ya-confiaron-en-Rapiclean-(3).png" alt="Rapiclean">
    </a>

  <!-- NUEVA PUBLICIDAD SOLICITADA (antes del footer) -->
  <div class="final-banner" style="margin:40px 0 60px;">
    <a href="https://wa.me/5493756505202?text=Hola,%20vi%20tu%20publicidad%20en%20AlquiYa%20y%20quiero%20m√°s%20info" target="_blank">
      <img src="https://i.postimg.cc/8cW9tc4x/Whats-App-Image-2025-12-08-at-10-19-35.jpg" 
           alt="Publicidad" 
           style="border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.2);">
    </a>
  </div>

    <a href="https://wa.me/5493764275443?text=Hola,+quiero+publicitar+en+AlquiYa&utm_source=chatgpt.com" target="_blank">
      <div id="publicidad-container">
        <p>Espacio Publicitario</p>
        <p>Haz clic para publicitar aqu√≠</p>
      </div>
    </a>
  </div>
  
  <!-- =============== PIE DE P√ÅGINA AZUL =============== -->
<footer>
  <div class="footer-container">
    <!-- Logo -->
    <div class="footer-logo">
      <img src="https://i.postimg.cc/FHXRBTTX/logo-Alqui-Ya-fondo-blanco-Photoroom-Photoroom.png" alt="Logo AlquiYa">
    </div>

    <!-- Men√∫s -->
    <div class="footer-menu">
      <a href="#" onclick="mostrarLista(); return false;">Lista</a>
      <a href="#" onclick="mostrarMapa(); return false;">Mapa</a>
      <a href="#" onclick="mostrarLogin(); return false;">Publicar</a>
    </div>

    <!-- Redes sociales -->
    <div class="footer-social">
      <a href="https://www.instagram.com/alquiya.st/?utm_source=ig_web_button_share_sheet" target="_blank">
        <img src="https://i.postimg.cc/GmVWTXX0/394a7aaecd6b8ce44528649681d9fa05.png" alt="Instagram">
      </a>
    </div>

    <!-- Copyright -->
    <div class="footer-copy">
      ¬© 2025 AlquiYa ‚Ä¢ Todos los derechos reservados
    </div>
  </div>
</footer>
  
<div id="alquiler-detalle">
<p id="metricas-error"></p>
</div>

<div id="panel-dueno">
<h2>Panel de Due√±os</h2>
<p id="bienvenida"></p>
<button onclick="logout()">Cerrar Sesi√≥n</button>
</div>
<!-- MODAL DE IM√ÅGENES -->
<div id="modal-img" onclick="if(event.target === this) cerrarModal()">
  <img id="img-grande" src="" alt="Imagen grande">
  <button class="close-btn" onclick="cerrarModal()">X</button>
  <button class="prev-btn" onclick="cambiarImagen(-1)"><</button>
  <button class="next-btn" onclick="cambiarImagen(1)">></button>
</div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
/* =========================
CONFIG
*/
const webAppURL = "https://script.google.com/macros/s/AKfycbyFvDRwPZoG6ChhvcxGm6B27ziD6Qkg4RcH0TI9K59b7zPz7iFxy7mgmbs5mo5T-TxD/exec";
const cloudinaryURL = "https://api.cloudinary.com/v1_1/dnugmwern/image/upload";
const cloudinaryUploadPreset = "preset_alquileres";
let currentImages = [];
let currentImageIndex = 0;
/* =========================
MAPA
*/
let map = null;
let markersLayer = null;
function initializeMap() {
  if (map) return; // Prevent reinitialization
  const mapElement = document.getElementById('map');
  if (!mapElement) {
    console.error("Map element not found");
    document.getElementById("loading-msg").textContent = "Error: No se encontr√≥ el contenedor del mapa.";
    return false;
  }
  try {
    map = L.map('map').setView([-28.5503, -56.0406], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '¬© OpenStreetMap'
    }).addTo(map);
    markersLayer = L.layerGroup().addTo(map);
    return true;
  } catch (error) {
    console.error("Error initializing map:", error);
    document.getElementById("loading-msg").textContent = "Error al cargar el mapa. Por favor, intenta de nuevo.";
    return false;
  }
}
/* =========================
UTILS
*/
function getField(obj, keys) {
  for (const k of keys) {
    if (Object.prototype.hasOwnProperty.call(obj, k) && obj[k] != null && obj[k] !== "") return obj[k];
  }
  return "";
}
function toNumber(val) {
  if (typeof val === "number") return val;
  if (!val) return 0;
  const clean = String(val).replace(/[^\d.,-]/g, "").replace(/\./g, "").replace(",", ".");
  const num = parseFloat(clean);
  return isNaN(num) ? 0 : num;
}
function toInt(val, def = 0) {
  const n = parseInt(val, 10);
  return isNaN(n) ? def : n;
}
function parseDate(dateStr) {
  if (!dateStr) return null;
  const [day, month, year] = dateStr.split('/').map(Number);
  if (!day || !month || !year) return null;
  return new Date(year, month - 1, day);
}
/* =========================
FORMATO MONEDA
*/
function formatCurrency(el) {
  let selectionStart = el.selectionStart;
  let raw = String(el.value || "");
  let digits = raw.replace(/\D/g, '');
  if (digits === '') { el.value = ''; return; }
  let n = parseInt(digits, 10);
  if (isNaN(n)) { el.value = ''; return; }
  let formatted = n.toLocaleString('es-AR');
  el.value = '$' + formatted;
  try { el.setSelectionRange(el.value.length, el.value.length); } catch (e) {}
}
function parseCurrency(str) {
  if (!str) return 0;
  let cleaned = String(str).replace(/[^\d]/g, '');
  if (cleaned === '') return 0;
  let num = parseInt(cleaned, 10);
  return isNaN(num) ? 0 : num;
}
function formatPrice(num) {
  if (!num) return "";
  const clean = String(num).replace(/[^\d]/g, "");
  const formatted = parseInt(clean, 10).toLocaleString('es-AR');
  return "$" + formatted.replace(/,/g, ".");
}

  // === MODAL IM√ÅGENES - CORREGIDO PARA EVITAR "undefined" ===
function abrirModal(src, images, index = 0) {
  if (!images || images.length === 0 || !images.every(url => url && url.trim() !== "")) return;
  currentImages = images.filter(url => url && url.trim() !== ""); // ‚Üê Filtra URLs vac√≠as
  currentImageIndex = index < currentImages.length ? index : 0;
  document.getElementById("img-grande").src = currentImages[currentImageIndex];
  document.getElementById("modal-img").style.display = "flex";
  document.querySelector(".prev-btn").style.display = currentImages.length > 1 ? "block" : "none";
  document.querySelector(".next-btn").style.display = currentImages.length > 1 ? "block" : "none";
}
function cerrarModal() { document.getElementById("modal-img").style.display = "none"; }
function cambiarImagen(dir) {
  if (currentImages.length === 0) return;
  currentImageIndex = (currentImageIndex + dir + currentImages.length) % currentImages.length;
  const nuevaUrl = currentImages[currentImageIndex];
  if (nuevaUrl && nuevaUrl.trim() !== "") {
    document.getElementById("img-grande").src = nuevaUrl;
  }
}
  // FILTROS COMPARTIDOS
function toggleFiltros() {
  const f = document.getElementById("filtros");
  f.style.display = (f.style.display === "none" || !f.style.display) ? "flex" : "none";
}
function aplicarFiltros() {
  if (document.getElementById("vista-lista").style.display === "block") cargarPropiedadesLista();
  else cargarAlquileres();
  toggleFiltros();
}

// === IR A DETALLE + M√âTRICA ===
async function irADetalle(id) {
  if (id) {
    await fetch(`${webAppURL}?action=incrementarmetrica&idPropiedad=${id}&metrica=vistas`, {method:"GET"}).catch(()=>{});
  }
  window.open(`https://www.alquiya.com.ar/propiedad.html?id=${id}`, "_blank");
}

async function cargarPropiedadesLista() {
  const contenedor = document.getElementById("lista-propiedades");
  contenedor.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:80px;font-size:1.4rem;color:#666;">Cargando...</div>';

  const filtroAmb       = parseInt(document.getElementById("filtroAmb").value) || 0;
  const filtroMin       = parseCurrency(document.getElementById("filtroMin").value) || 0;
  const filtroMax       = parseCurrency(document.getElementById("filtroMax").value) || Infinity;
  const filtroMascotas  = document.getElementById("filtroMascotas").checked;
  const filtroAmoblado  = document.getElementById("filtroAmoblado").checked;
  const filtroTipo      = document.getElementById("filtroTipo").value;

  try {
    const res = await fetch(webAppURL + "?action=getAlquileres&t=" + Date.now());
    const data = await res.json();

    if (!data.success || data.data.length === 0) {
      contenedor.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:80px;color:#95a5a6;">No hay propiedades activas</div>';
      return;
    }

    const filtradas = data.data.filter(p => {
      if (filtroTipo && p.Tipo !== filtroTipo) return false;
      if (filtroAmb && toInt(p["Nro Ambientes"] || p.Ambientes) !== filtroAmb) return false;

      const precio = toNumber(p.Precio);
      if (precio < filtroMin || precio > filtroMax) return false;

      /* FILTROS MASCOTAS Y AMOBLADO */
      if (filtroMascotas && (p.Mascotas || "").toLowerCase() !== "s√≠") return false;
      if (filtroAmoblado && (p.Amoblado || "").toLowerCase() !== "s√≠") return false;

      return true;
    });

    contenedor.innerHTML = "";
    if (filtradas.length === 0) {
      contenedor.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:80px;color:#95a5a6;">No se encontraron resultados</div>';
      return;
    }

    filtradas.forEach(p => {
      const fotos = (p.Fotos || "").split(",").map(f => f.trim()).filter(Boolean).map(driveUrlDirect);
      const primeraImg = fotos[0] || "https://via.placeholder.com/400x250?text=Sin+Imagen";
      const precioRaw = toNumber(p.Precio);
      const precio = precioRaw ? "$" + precioRaw.toLocaleString("es-AR") : "Consultar";
      const titulo = getField(p, ["T√≠tulo", "titulo", "Titulo", "T√≠tulo Propiedad"]) || "Sin t√≠tulo";
      const tipoPropiedad = getField(p, ["Tipo"]) || "Propiedad";
      const id = getField(p, ["ID Propiedad", "idPropiedad", "ID"]) || "";

      /* AMBIENTES */
      const ambientesStr = getField(p, ["Nro Ambientes", "Ambientes", "Ambientes "]) || "1";
      const nroAmbientes = toInt(ambientesStr);
      const textoAmbientes = nroAmbientes === 1 ? "Monoambiente" : nroAmbientes + " ambientes";

      /* SUBTIPO (columna R) */
      const subtipo = getField(p, ["Subtipo", "Subtipo de propiedad", "R"])?.trim();

      const card = document.createElement("div");
      card.className = "property-card";
      card.innerHTML = `
        <div style="position: relative; border-radius: 15px; overflow: hidden;">
          <img src="${primeraImg}" alt="${titulo}" style="width:100%; height:250px; object-fit:cover; display:block;">

          <!-- Subtipo arriba izquierda -->
          ${subtipo ? `
            <div style="position:absolute; top:12px; left:12px; background:var(--primary); color:white; padding:8px 16px; border-radius:50px; font-size:0.95rem; font-weight:600; box-shadow:0 4px 12px rgba(52,131,250,0.4); z-index:2;">
              ${subtipo}
            </div>
          ` : ''}

          <!-- NRO DE AMBIENTES ‚Äì M√ÅS ARRIBA Y SIN FONDO -->
          <div class="ambientes-overlay">
            ${textoAmbientes}
          </div>
        </div>

        <div class="property-title" style="margin:18px 0 8px; font-size:1.55rem; color:#333; line-height:1.3;">
          ${titulo}
        </div>
        <div class="property-price" style="margin:0 0 6px; font-size:1.75rem; color:#28a745; font-weight:bold;">
          ${precio}
        </div>
        <div style="color:#222; font-size:1.2rem; font-weight:600; margin-bottom:8px;">
          ${textoAmbientes}
        </div>
        <div style="color:#555; font-size:1rem; margin-bottom:18px; font-weight:500;">
          ${tipoPropiedad}
        </div>
        <button class="ver-detalles-btn">Ver detalles</button>
      `;

      /* Eventos */
      card.querySelector("img").onclick = e => {
        e.stopPropagation();
        if (fotos.length) abrirModal(fotos[0], fotos);
      };
      card.onclick = e => {
        if (!e.target.closest("img") && !e.target.closest("button")) {
          irADetalle(id);
        }
      };
      card.querySelector(".ver-detalles-btn").onclick = e => {
        e.stopPropagation();
        irADetalle(id);
      };

      contenedor.appendChild(card);
    });
  } catch (err) {
    console.error("Error cargando lista:", err);
    contenedor.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:80px;color:#e74c3c;">
      Error al cargar las propiedades<br>
      <button onclick="cargarPropiedadesLista()" style="margin-top:15px;padding:10px 20px;background:var(--primary);color:white;border:none;border-radius:50px;cursor:pointer;">Reintentar</button>
    </div>`;
  }
}
  
function driveUrlDirect(url) {
  if (!url) return "";
  const match = url.match(/\/d\/([a-zA-Z0-9_-]+)|id=([a-zA-Z0-9_-]+)/);
  const id = match ? (match[1] || match[2]) : null;
  return id ? `https://drive.google.com/uc?export=view&id=${id}` : url;
}
  
// NAVEGACI√ìN - CIERRA PUBLICAR AL CAMBIAR DE PESTA√ëA
function mostrarLista() {
  document.getElementById("vista-lista").style.display = "block";
  document.getElementById("vista-mapa").style.display = "none";
  document.getElementById("vista-publicar").style.display = "none"; // ‚Üê Cierra login/registro
  document.getElementById("botones-filtros-avisos").classList.add("visible");
  document.querySelectorAll("nav a").forEach(a => a.classList.remove("active"));
  document.getElementById("tab-lista").classList.add("active");
  cargarPropiedadesLista();
}

function mostrarMapa() {
  document.getElementById("vista-lista").style.display = "none";
  document.getElementById("vista-mapa").style.display = "block";
  document.getElementById("vista-publicar").style.display = "none"; // ‚Üê Cierra login/registro
  document.getElementById("botones-filtros-avisos").classList.add("visible");
  document.querySelectorAll("nav a").forEach(a => a.classList.remove("active"));
  document.getElementById("tab-mapa").classList.add("active");
  cargarAlquileres();
}

function mostrarLogin() {
  document.getElementById("vista-lista").style.display = "none";
  document.getElementById("vista-mapa").style.display = "none";
  document.getElementById("vista-publicar").style.display = "block";

  document.querySelectorAll("nav a").forEach(a => a.classList.remove("active"));
  document.getElementById("tab-publicar").classList.add("active");

  // Ocultar botones en Publicar
  document.getElementById("botones-filtros-avisos").classList.remove("visible");

  document.getElementById("login").style.display = "block";
}
function mostrarRegistro() {
  document.getElementById("login").style.display = "none";
  document.getElementById("registro").style.display = "block";
  document.getElementById("map").style.display = "none";
  document.getElementById("filtros").style.display = "none";
  document.getElementById("panel-dueno").style.display = "none";
  document.getElementById("avisos-panel").style.display = "none";
  document.getElementById("alquiler-detalle").style.display = "none";
  document.getElementById("boton-filtros-container").style.display = "none";
  document.getElementById("loading-msg").style.display = "none";
  document.getElementById("rapiclean-img-container").style.display = "none";
}
function mostrarAvisos() {
  document.getElementById("map").style.display = "none";
  document.getElementById("filtros").style.display = "none";
  document.getElementById("login").style.display = "none";
  document.getElementById("panel-dueno").style.display = "none";
  document.getElementById("registro").style.display = "none";
  document.getElementById("avisos-panel").style.display = "block";
  document.getElementById("alquiler-detalle").style.display = "none";
  document.getElementById("boton-filtros-container").style.display = "none";
  document.getElementById("loading-msg").style.display = "none";
  document.getElementById("rapiclean-img-container").style.display = "none";
}
  // === CANCELAR EN PANEL DE AVISOS (CIERRA EL PANEL) ===
function cerrarAvisos() {
  document.getElementById("avisos-panel").style.display = "none";
  document.getElementById("map").style.display = "block";
  document.getElementById("filtros").style.display = "none";
}
/* =========================
T√âRMINOS Y CONDICIONES
*/
function mostrarTerminos() {
  const terminosAceptados = localStorage.getItem("terminosAceptados");
  if (!terminosAceptados) {
    document.getElementById("modal-terminos").style.display = "flex";
  }
}
function aceptarTerminos() {
  localStorage.setItem("terminosAceptados", "true");
  document.getElementById("modal-terminos").style.display = "none";
}
/* =========================
FETCH HELPER
*/
async function makeRequest(url, options) {
  try {
    const response = await fetch(url, options);
    if (!response.ok && options.mode !== 'no-cors') {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    if (options.mode === 'no-cors') {
      return null;
    }
    const text = await response.text();
    console.log("Raw response:", text);
    try {
      return JSON.parse(text);
    } catch (e) {
      console.error("JSON parsing error:", e, "Raw text:", text);
      throw new Error("Respuesta del servidor no es un JSON v√°lido");
    }
  } catch (error) {
    console.error("Fetch error:", error);
    throw new Error("No se pudo conectar con el servidor. Por favor, intenta de nuevo.");
  }
}
/* =========================
AUTH
*/
function login() {
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  if (!email || !password) {
    document.getElementById("login-msg").textContent = "Ingrese email y contrase√±a";
    document.getElementById("login-loading").style.display = "none";
    return;
  }
  document.getElementById("login-loading").style.display = "block";
  document.getElementById("login-msg").textContent = "";
  makeRequest(webAppURL + "?action=verificarLogin&email=" + encodeURIComponent(email) + "&password=" + encodeURIComponent(password), {
    method: "GET",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    }
  })
    .then(data => {
      document.getElementById("login-loading").style.display = "none";
      if (data.success) {
        localStorage.setItem("dueno", email);
        localStorage.setItem("dueno_email", email);
        window.location.href = "due√±os.html";
      } else {
        if (data.error === "Usuario no registrado") {
          document.getElementById("login-msg").textContent = "Usuario no registrado";
        } else if (data.error === "Contrase√±a incorrecta") {
          document.getElementById("login-msg").textContent = "Contrase√±a incorrecta";
        } else {
          document.getElementById("login-msg").textContent = "Error en el inicio de sesi√≥n";
        }
      }
    })
    .catch(error => {
      document.getElementById("login-loading").style.display = "none";
      document.getElementById("login-msg").textContent = error.message;
    });
}
function logout() {
  localStorage.removeItem("dueno");
  localStorage.removeItem("dueno_email");
  mostrarLogin();
}
function registrarDueno() {
  const email = document.getElementById("reg_email").value.trim();
  const nombre = document.getElementById("reg_nombre").value.trim();
  const password = document.getElementById("reg_password").value.trim();
  const codigoPais = document.getElementById("reg_codigo_pais").value;
  const contacto = document.getElementById("reg_contacto").value.trim();
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  const contactoRegex = /^\d{9,10}$/;
  if (!email || !nombre || !password || !contacto) {
    document.getElementById("registro-msg").style.color = "red";
    document.getElementById("registro-msg").textContent = "Complete todos los campos";
    return;
  }
  if (!emailRegex.test(email)) {
    document.getElementById("registro-msg").style.color = "red";
    document.getElementById("registro-msg").textContent = "Ingrese un email v√°lido";
    return;
  }
  if (!contactoRegex.test(contacto)) {
    document.getElementById("registro-msg").style.color = "red";
    document.getElementById("registro-msg").textContent = "Ingrese un n√∫mero de WhatsApp v√°lido (9-10 d√≠gitos)";
    return;
  }
  if (password.length < 6) {
    document.getElementById("registro-msg").style.color = "red";
    document.getElementById("registro-msg").textContent = "La contrase√±a debe tener al menos 6 caracteres";
    return;
  }
  const params = new URLSearchParams();
  params.append("action", "registrarDueno");
  params.append("email", email);
  params.append("nombre", nombre);
  params.append("password", password);
  params.append("contacto", codigoPais + contacto);
  makeRequest(webAppURL, {
    method: "POST",
    body: params,
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    },
    mode: "no-cors"
  })
    .then(() => {
      document.getElementById("registro-msg").style.color = "green";
      document.getElementById("registro-msg").innerHTML = "Due√±o registrado con √©xito.<br><button onclick='mostrarLogin()'>Ir a Login</button>";
      setTimeout(() => mostrarLogin(), 2000);
    })
    .catch(error => {
      console.error("Error en registro:", error);
      document.getElementById("registro-msg").style.color = "red";
      document.getElementById("registro-msg").textContent = `Error: ${error.message}`;
    });
}
/* =========================
REGISTRO DE EMAILS PARA AVISOS
*/
function registrarEmailAvisos() {
  const email = document.getElementById("avisos_email").value.trim();
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!email) {
    document.getElementById("avisos-msg").style.color = "red";
    document.getElementById("avisos-msg").textContent = "Ingrese un email";
    return;
  }
  if (!emailRegex.test(email)) {
    document.getElementById("avisos-msg").style.color = "red";
    document.getElementById("avisos-msg").textContent = "Ingrese un email v√°lido";
    return;
  }
  const params = new URLSearchParams();
  params.append("action", "suscribirNotificaciones");
  params.append("email", email);
  makeRequest(webAppURL, {
    method: "POST",
    body: params,
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    },
    mode: "no-cors"
  })
    .then(() => {
      document.getElementById("avisos-msg").style.color = "green";
      document.getElementById("avisos-msg").textContent = "Email registrado con √©xito para recibir notificaciones.";
      document.getElementById("avisos_email").value = "";
      setTimeout(() => mostrarMapa(), 2000);
    })
    .catch(error => {
      document.getElementById("avisos-msg").style.color = "red";
      document.getElementById("avisos-msg").textContent = error.message;
    });
}
/* =========================
IM√ÅGENES
*/
async function subirImagenCloudinary(file) {
  const data = new FormData();
  data.append("file", file);
  data.append("upload_preset", cloudinaryUploadPreset);
  try {
    const res = await fetch(cloudinaryURL, { method: "POST", body: data });
    const json = await res.json();
    return json.secure_url;
  } catch (err) {
    console.error("Error subiendo imagen a Cloudinary:", err);
    return null;
  }
}
function driveUrlDirect(url) {
  let fileId = null;
  if (url && url.includes("drive.google.com")) {
    let match = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
    if (match) fileId = match[1];
    else {
      match = url.match(/id=([a-zA-Z0-9_-]+)/);
      if (match) fileId = match[1];
    }
  }
  return fileId ? `https://drive.google.com/uc?export=view&id=${fileId}` : url;
}
// === MODAL IM√ÅGENES - 100% SEGURO CONTRA "undefined" ===
function abrirModal(src, images, index = 0) {
  if (!images || images.length === 0) return;
  currentImages = images.filter(url => url && url.trim() !== "" && !url.includes("undefined"));
  if (currentImages.length === 0) return;
  currentImageIndex = index < currentImages.length ? index : 0;
  document.getElementById("img-grande").src = currentImages[currentImageIndex];
  document.getElementById("modal-img").style.display = "flex";
  document.querySelector(".prev-btn").style.display = currentImages.length > 1 ? "block" : "none";
  document.querySelector(".next-btn").style.display = currentImages.length > 1 ? "block" : "none";
}
function cerrarModal() { document.getElementById("modal-img").style.display = "none"; }
function cambiarImagen(dir) {
  if (currentImages.length <= 1) return;
  currentImageIndex = (currentImageIndex + dir + currentImages.length) % currentImages.length;
  const nuevaUrl = currentImages[currentImageIndex];
  if (nuevaUrl && nuevaUrl.trim() !== "" && !nuevaUrl.includes("undefined")) {
    document.getElementById("img-grande").src = nuevaUrl;
  }
}
/* =========================
M√âTRICAS
*/
async function incrementarMetrica(idPropiedad, metrica) {
  if (!idPropiedad) {
    console.warn("ID de propiedad vac√≠o, no se incrementa m√©trica");
    return;
  }
  const url = `${webAppURL}?action=incrementarmetrica&idPropiedad=${encodeURIComponent(idPropiedad)}&metrica=${metrica}&t=${Date.now()}`;
  console.log("Intentando incrementar:", url); // ‚Üê Esto te va a salvar la vida
  try {
    const res = await fetch(url, {
      method: "GET",
      cache: "no-cache"
    });
    if (!res.ok) {
      const text = await res.text();
      console.error("Error HTTP:", res.status, text);
      throw new Error("HTTP " + res.status);
    }
    const data = await res.json();
    console.log(`M√©trica ${metrica} incrementada ‚Üí`, data);
  } catch (err) {
    console.error("Fall√≥ incrementarMetrica:", err);
    // No rompemos la UX
  }
}
/* === FUNCI√ìN PARA OBTENER FOTO DE PERFIL (SIN AWAIT AQU√ç) === */
async function obtenerFotoPerfil(emailDueno) {
  if (!emailDueno) return "https://i.postimg.cc/0jFNDZ7Y/default-avatar.png";
  try {
    const res = await fetch(`${webAppURL}?action=obtenerFotoPerfil&email=${encodeURIComponent(emailDueno)}`);
    const data = await res.json();
    return data.foto || "https://i.postimg.cc/0jFNDZ7Y/default-avatar.png";
  } catch {
    return "https://i.postimg.cc/0jFNDZ7Y/default-avatar.png";
  }
}
function cargarAlquileres() {
  const loadingEl = document.getElementById("loading-msg");
  loadingEl.style.display = "block";
  loadingEl.textContent = "Cargando alquileres disponibles...";

  if (!map || !markersLayer) {
    if (!initializeMap()) {
      loadingEl.textContent = "Error: No se pudo inicializar el mapa.";
      return;
    }
  }
  markersLayer.clearLayers();

  // === MARCADORES EST√ÅTICOS (sin cambios) ===
  const uniIcon = L.divIcon({ className: 'marker-icon', html: 'üéì', iconSize: [30, 30], iconAnchor: [15, 15] });
const hospIcon = L.divIcon({ className: 'marker-icon', html: 'üè•', iconSize: [30, 30], iconAnchor: [15, 15] });
const superIcon = L.divIcon({ className: 'marker-icon', html: 'üõí', iconSize: [30, 30], iconAnchor: [15, 15] });
const busIcon = L.divIcon({ className: 'marker-icon', html: 'üöå', iconSize: [30, 30], iconAnchor: [15, 15] });
const policeIcon = L.divIcon({ className: 'marker-icon', html: 'üëÆ', iconSize: [30, 30], iconAnchor: [15, 15] });
  L.marker([-28.5509978, -56.0409727], { icon: uniIcon }).addTo(markersLayer).bindPopup("<b>Facultad Fundaci√≥n Barcel√≥</b>");
  L.marker([-28.5551127, -56.0389282], { icon: hospIcon }).addTo(markersLayer).bindPopup("<b>Hospital Universitario San Juan Bautista</b>");
  L.marker([-28.5519443, -56.0401962], { icon: superIcon }).addTo(markersLayer).bindPopup("<b>Supermercado La Bomba</b>");
  L.marker([-28.5472635, -56.0438082], { icon: superIcon }).addTo(markersLayer).bindPopup("<b>Supermermercado La Previsora</b>");
  L.marker([-28.5462903, -56.0440365], { icon: superIcon }).addTo(markersLayer).bindPopup("<b>Supermercado La Econom√≠a</b>");
  L.marker([-28.5468697, -56.0432862], { icon: busIcon }).addTo(markersLayer).bindPopup("<b>Terminal de Omnibus</b>");
  L.marker([-28.5487787, -56.0396171], { icon: policeIcon }).addTo(markersLayer).bindPopup("<b>Polic√≠a</b>");

  // === FILTROS ===
  const filtroAmb = toInt(document.getElementById("filtroAmb").value);
  const filtroMin = parseCurrency(document.getElementById("filtroMin").value) || 0;
  const filtroMax = parseCurrency(document.getElementById("filtroMax").value) || Infinity;
  const filtroMascotas = document.getElementById("filtroMascotas").checked;
  const filtroAmoblado = document.getElementById("filtroAmoblado").checked;
  const filtroTipo = document.getElementById("filtroTipo").value;

  makeRequest(webAppURL + "?action=getAlquileres", { method: "GET" })
    .then(res => {
      loadingEl.style.display = "none";
      if (!res.success || !Array.isArray(res.data)) {
        loadingEl.textContent = "Error al cargar alquileres. Intenta de nuevo.";
        console.error("Error en respuesta:", res);
        return;
      }

      let cont = 0;
      res.data.forEach(a => {
        // === VALIDACIONES ===
        const plan = getField(a, ["Plan"]);
        const fechaVencimientoStr = getField(a, ["Fecha de Vencimiento", "FechaVencimiento", "Vencimiento"]);
        if (plan === "Prueba") {
          const fechaVencimiento = parseDate(fechaVencimientoStr);
          if (fechaVencimiento && new Date() > fechaVencimiento) return;
        }

        const lat = parseFloat(getField(a, ["Latitud", "lat"]));
        const lng = parseFloat(getField(a, ["Longitud", "lng"]));
        if (isNaN(lat) || isNaN(lng)) return;

        const tipo = getField(a, ["Tipo"]) || "Propiedad";
        if (filtroTipo && tipo !== filtroTipo) return;

        const nroAmb = toInt(getField(a, ["Nro Ambientes", "Ambientes"]));
        if (filtroAmb && nroAmb !== filtroAmb) return;

        const precioRaw = getField(a, ["Precio"]);
        const precio = toNumber(precioRaw);
        const formattedPrecio = formatPrice(precioRaw);
        if (precio < filtroMin || precio > filtroMax) return;

        const mascotas = getField(a, ["Mascotas"]);
        if (filtroMascotas && (!mascotas || mascotas.toLowerCase() !== "s√≠")) return;

        const amoblado = getField(a, ["Amoblado"]);
        if (filtroAmoblado && (!amoblado || amoblado.toLowerCase() !== "s√≠")) return;

        // === DATOS IMPORTANTES ===
        const idPropiedad = getField(a, ["ID Propiedad", "idPropiedad", "ID"]);
        const direccion = getField(a, ["Direccion", "Direcci√≥n", "Domicilio"]);
        const contacto = getField(a, ["Contacto", "Whatsapp", "WhatsApp"]);
        const fotos = getField(a, ["Fotos", "Imagenes", "Im√°genes", "images"]);
        const infoIngreso = getField(a, ["Informacion ingreso", "Informaci√≥n ingreso"]);
        const detalles = getField(a, ["Detalles", "Detalle", "Descripcion"]);

        // === T√çTULO (columna U) ===
        const titulo = getField(a, ["T√≠tulo", "titulo", "Titulo", "T√≠tulo Propiedad"]) || tipo;

        // === FOTO DEL DUE√ëO (viene del backend) ===
        const fotoPerfil = getField(a, ["FotoPerfil", "fotoPerfil", "Foto Perfil", "FotoPerfilDue√±o"])
          || "https://i.postimg.cc/0jFNDZ7Y/default-avatar.png";

        // === ICONO DE LA PROPIEDAD (emojis originales) ===
      let iconHtml;
if (tipo === "Temporario") {
iconHtml = '‚åõ';
} else if (tipo === "Local") {
iconHtml = 'üõçÔ∏è';
} else {
iconHtml = 'üè†<span style="font-size:12px;margin-left:2px;">' + (nroAmb || "-") + '</span>';
}

        const icon = L.divIcon({
          className: 'marker-icon',
          html: iconHtml,
          iconSize: [30, 30],
          iconAnchor: [15, 15]
        });

        const marker = L.marker([lat, lng], { icon }).addTo(markersLayer);

        // === POPUP DEL MARCADOR (solo T√≠tulo + Tipo + Precio) ===
        const popupDiv = document.createElement('div');
        popupDiv.style.position = "relative";
        popupDiv.style.padding = "12px";
        popupDiv.style.minWidth = "240px";
        popupDiv.style.fontSize = "14px";

        // Foto del due√±o (clic para abrir grande)
        const popupImg = document.createElement('img');
        popupImg.className = "popup-profile-img";
        popupImg.src = fotoPerfil;
        popupImg.alt = "Foto del due√±o";
        popupImg.style.cursor = "pointer";
        popupImg.onclick = (e) => {
          e.stopPropagation();
          abrirModal(fotoPerfil, [fotoPerfil], 0);
        };
        popupDiv.appendChild(popupImg);

        // Informaci√≥n del popup
        popupDiv.innerHTML += `
          <div style="margin-right:60px;">
            <b style="font-size:16px;display:block;margin-bottom:4px;">${titulo}</b>
            <b>Tipo:</b> ${tipo}<br>
            <b>Precio:</b> ${formattedPrecio || 'Consultar'}
          </div>
        `;

        const verBtn = document.createElement('button');
        verBtn.className = 'popup-button';
        verBtn.textContent = 'Ver Detalles';
        verBtn.onclick = async () => {
          if (idPropiedad) await incrementarMetrica(idPropiedad, "vistas");

          const detalle = document.getElementById('alquiler-detalle');
          detalle.innerHTML = `<h2>${titulo}</h2><p id="metricas-error"></p>`;

          // Foto del due√±o en el detalle (tambi√©n clic para grande)
          const profileImg = document.createElement('img');
          profileImg.className = "owner-profile-img";
          profileImg.src = fotoPerfil;
          profileImg.alt = "Foto del due√±o";
          profileImg.style.cursor = "pointer";
          profileImg.onclick = () => abrirModal(fotoPerfil, [fotoPerfil], 0);
          detalle.appendChild(profileImg);

          // Detalles completos
          const rows = [
            ['Tipo', tipo],
            ['Direcci√≥n', direccion || 'No disponible'],
            ['Precio', formattedPrecio || '-'],
            ['Ambientes', nroAmb || '-'],
            ['Mascotas', mascotas || '-'],
            ['Amoblado', amoblado || '-'],
            ['Informaci√≥n de ingreso', infoIngreso || '-'],
            ['Detalles', detalles || '-']
          ];

          rows.forEach(([label, val]) => {
            if (val && val !== 'No disponible' && val !== '-') {
              const p = document.createElement('p');
              p.innerHTML = `<b>${label}:</b> ${val}`;
              detalle.appendChild(p);
            }
          });

          // Im√°genes de la propiedad
          const imgContainer = document.createElement('div');
          imgContainer.id = 'imagenes-container';
          if (fotos) {
            const urls = fotos.split(',').map(f => driveUrlDirect(f.trim())).filter(Boolean);
            urls.forEach((url, i) => {
              const img = document.createElement('img');
              img.src = url;
              img.alt = "Propiedad";
              img.onclick = () => abrirModal(url, urls, i);
              imgContainer.appendChild(img);
            });
          }
          detalle.appendChild(imgContainer);

          // Botones de acci√≥n
          const actionDiv = document.createElement('div');
          actionDiv.className = 'action-buttons';

          if (contacto) {
            const waBtn = document.createElement('button');
            waBtn.textContent = 'Contactar por WhatsApp';
            waBtn.style.cssText = 'background:#25D366;color:white;padding:1rem 2rem;border-radius:14px;border:none;font-weight:600;cursor:pointer;margin:5px;';
            waBtn.onclick = () => {
              if (idPropiedad) incrementarMetrica(idPropiedad, "contactos");
              const msg = `Hola, consulto por "${titulo}"`;
              window.open(`https://wa.me/${contacto}?text=${encodeURIComponent(msg)}`, '_blank');
            };
            actionDiv.appendChild(waBtn);
          }

          if (idPropiedad) {
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-share-btn';
            copyBtn.setAttribute('data-id', idPropiedad);
            copyBtn.textContent = 'Copiar Enlace';
            actionDiv.appendChild(copyBtn);
          }

          detalle.appendChild(actionDiv);

          detalle.style.display = 'block';
          detalle.classList.add("highlight");
          detalle.scrollIntoView({ behavior: "smooth" });
          setTimeout(() => detalle.classList.remove("highlight"), 1200);
          map.invalidateSize();
        };

        popupDiv.appendChild(verBtn);
        marker.bindPopup(popupDiv);
        cont++;
      });

      if (cont === 0) {
        loadingEl.textContent = "No se encontraron alquileres con los filtros actuales.";
      }
    })
    .catch(err => {
      loadingEl.style.display = "none";
      loadingEl.textContent = "Error de conexi√≥n. Reintentando...";
      console.error("Error:", err);
    });
}
/* =========================
PASSWORD VISIBILITY TOGGLE
*/
function togglePassword(inputId) {
  const input = document.getElementById(inputId);
  const eyeIcon = input.nextElementSibling;
  if (input.type === "password") {
    input.type = "text";
    eyeIcon.style.backgroundImage = "url('https://img.icons8.com/ios/50/000000/invisible.png')";
  } else {
    input.type = "password";
    eyeIcon.style.backgroundImage = "url('https://img.icons8.com/ios/50/000000/visible.png')";
  }
  }
// === FUNCI√ìN COPIAR ENLACE (nueva) ===
document.addEventListener('click', function(e) {
  if (e.target && e.target.classList.contains('copy-share-btn')) {
    const idPropiedad = e.target.getAttribute('data-id');
    const url = `https://www.alquiya.com.ar/propiedad.html?id=${idPropiedad}`;
    fetch(`${webAppURL}?action=generarEnlaceCompartido&id=${idPropiedad}`, {
      method: 'GET',
      mode: 'no-cors'
    }).catch(() => {});
    navigator.clipboard.writeText(url).then(() => {
      const textoOriginal = e.target.innerHTML;
      e.target.innerHTML = "Enlace copiado";
      e.target.style.background = "#10b981";
      setTimeout(() => {
        e.target.innerHTML = textoOriginal;
        e.target.style.background = "";
      }, 2000);
    }).catch(() => {
      alert('Enlace (copia manual):\n' + url);
    });
  }
});
/* =========================
INIT
*/
window.onload = () => {
  mostrarTerminos();
  mostrarLista();        // <-- inicia en Lista
  cargarPropiedadesLista(); // <-- carga inmediata
};
</script>
</body>
</html>
