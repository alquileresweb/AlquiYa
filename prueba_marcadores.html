<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Prueba Marcadores</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
#map { height: 90vh; width: 100%; }
</style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script>
// URL del CSV publicado
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR5ywR4kynlqCe7boNscWy3jq2o40iTpyx1qC1enzUVGuJyfi-GZMRrxqDMUeR3HC4w-EB2l90X5Zyp/pub?gid=376993222&single=true&output=csv";

// Crear mapa
let map = L.map('map').setView([-28.5503, -56.0406], 14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '© OpenStreetMap'
}).addTo(map);

// Marcadores fijos
L.marker([-28.5544015,-56.0389695]).addTo(map).bindPopup("<b>Facultad Fundación Barceló</b>");
L.marker([-28.5543092,-56.0390371]).addTo(map).bindPopup("<b>Hospital</b>");

// Cargar alquileres desde Google Sheet
Papa.parse(sheetURL, {
  download: true,
  header: true,
  complete: function(results) {
    console.log("Datos leídos del sheet:", results.data);

    results.data.forEach(a => {
      const tipo = a["Tipo"] || a["tipo"];
      const estado = a["Estado"] || a["estado"];
      const lat = parseFloat(a["Latitud"] || a["latitud"]);
      const lng = parseFloat(a["Longitud"] || a["longitud"]);
      const direccion = a["Direccion"] || a["direccion"];
      const ambientes = a["Ambientes"] || a["ambientes"];
      const precio = a["Precio"] || a["precio"];
      const contacto = a["Contacto"] || a["contacto"];
      const fotos = a["Fotos"] || a["fotos"];

      if (tipo === "alquiler" && estado && estado.toLowerCase() === "activo" && !isNaN(lat) && !isNaN(lng)) {
        let color = "red";
        const amb = (ambientes || "").toLowerCase();
        if (amb.includes("mono") || amb.includes("1")) color = "yellow";
        else if (amb.includes("2")) color = "green";
        else if (amb.includes("3")) color = "blue";

        const marker = L.circleMarker([lat, lng], { radius: 8, color: color, fillOpacity: 0.9 }).addTo(map);
        marker.bindPopup(`
          <b>${direccion}</b><br>
          Ambientes: ${ambientes}<br>
          Precio: ${precio}<br>
          Contacto: <a href="https://wa.me/${contacto}" target="_blank">${contacto}</a><br>
          ${fotos ? `<img src="${fotos}" width="150">` : ""}
        `);
      }
    });
  }
});
</script>
</body>
</html>
